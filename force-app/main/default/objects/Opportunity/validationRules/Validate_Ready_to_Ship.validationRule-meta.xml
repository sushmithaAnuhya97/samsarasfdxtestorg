<?xml version="1.0" encoding="UTF-8"?>
<ValidationRule xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>Validate_Ready_to_Ship</fullName>
    <active>true</active>
    <errorConditionFormula>AND   (
NOT(OR( 
($Permission.Validation_Rule_Exemption), 
(CONTAINS($Profile.Name,&quot;Finance&quot;)),
($Profile.Name=&quot;Order Operations Admin&quot;),
CONTAINS($Profile.Name,&quot;System Administrator&quot;),
$User.Id = $Label.Automated_Process_UserId  
)), 
   (RecordTypeId   &lt;&gt; &quot;0121a000000ARoK&quot;),
  OR (   
    ISPICKVAL(StageName, &quot;Closing&quot;),
    ISPICKVAL(StageName, &quot;Ready to Ship&quot;),
    ISPICKVAL(StageName, &quot;Closed Won&quot;)
  ),
  OR (
    ISBLANK( Shipping_Address_NEW__r.Shipping_FirstName__c ), 
    ISBLANK( Shipping_Address_NEW__r.Shipping_LastName__c ), 
    ISBLANK( Shipping_Address_NEW__r.Shipping_Email__c ), 
    ISBLANK(  Shipping_Address_NEW__r.Shipping_Contact__c  ),
    ISBLANK( Shipping_Address_NEW__r.Shipping_Address_Line_1__c ),
    ISBLANK( Shipping_Address_NEW__r.Shipping_City__c  ),
    AND(
       ISPICKVAL(Shipping_Address_NEW__r.Shipping_State__c, &quot;&quot;  ),
       OR(ISPICKVAL(Shipping_Address_NEW__r.Shipping_Country__c,&apos;United States&apos;),
          ISPICKVAL(Shipping_Address_NEW__r.Shipping_Country__c,&apos;Canada&apos;))
    ),
    ISBLANK( Shipping_Address_NEW__r.Shipping_Zip_Code__c  ),
    ISPICKVAL(Shipping_Address_NEW__r.Shipping_Country__c  ,&quot;&quot; ),

    Product_Count__c  &lt; 1
  )
)</errorConditionFormula>
    <errorMessage>The following information must be completed prior to moving an opportunity into Ready to Ship or Closed Won: 

1) Add products &amp; Primary shipping contact. 
2) The Shipping Contact in the Shipping Address object must have an email address</errorMessage>
</ValidationRule>
