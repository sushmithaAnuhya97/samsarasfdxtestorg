<?xml version="1.0" encoding="UTF-8"?>
<ValidationRule xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>Only_Allow_ENT_AE_User_to_Edit_Opp</fullName>
    <active>true</active>
    <description>OCB-27489 Only Allow ENT AE User to edit the Opportunity on Read Only Layout.</description>
    <errorConditionFormula>AND(
    $RecordType.DeveloperName = &quot;Read_Only&quot;,
    
    ISCHANGED(Opportunity__c),

    /* Validation Rule Exceptions */
    NOT(
        OR(
            $UserRole.Name = &quot;Management&quot;,
            $UserRole.Name = &quot;Operations&quot;,
            $Profile.Name = &quot;System Administrator&quot;,
            $Profile.Name = &quot;System Administrator API&quot;,
            $Permission.Validation_Rule_Exemption,
            $Setup.Global_Automation_Settings__c.Skip_Validation_Rule__c
        )
    ),

    /* Actual Business Logic Conditions */
    OR(
        ISBLANK(AE_Demo_Transfer_To__c), /* No AE assigned */
        $User.Id &lt;&gt; AE_Demo_Transfer_To__r.Id, /* Current user is not the AE */

        /* AE&apos;s role must meet the required patterns */
        NOT(
            AND(
                OR(
                    CONTAINS(AE_Demo_Transfer_To__r.UserRole.Name, &quot;COR&quot;),
                    CONTAINS(AE_Demo_Transfer_To__r.UserRole.Name, &quot;SEL&quot;),
                    CONTAINS(AE_Demo_Transfer_To__r.UserRole.Name, &quot;STR&quot;),
                    CONTAINS(AE_Demo_Transfer_To__r.UserRole.Name, &quot;ENT&quot;)
                ),
                CONTAINS(AE_Demo_Transfer_To__r.UserRole.Name, &quot;AE&quot;),
                NOT(CONTAINS(AE_Demo_Transfer_To__r.UserRole.Name, &quot;ADR&quot;))
            )
        )
    )
)</errorConditionFormula>
    <errorDisplayField>Opportunity__c</errorDisplayField>
    <errorMessage>Only Enterprise AE users are allowed to update opportunity value on read-only layout.</errorMessage>
</ValidationRule>
