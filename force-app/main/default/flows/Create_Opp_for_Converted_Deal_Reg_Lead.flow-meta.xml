<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Send_Email_Alert_on_Failure</name>
        <label>Send Email Alert on Failure</label>
        <locationX>1370</locationX>
        <locationY>1022</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <elementReference>Get_Partner_Registration_Records.Lead__r.Owner:User.Email</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <stringValue>An error occurred in the Create Opportunity Flow</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>ErrorEmailBodyTemplate</elementReference>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
        <offset>0</offset>
    </actionCalls>
    <actionCalls>
        <name>UpdateAccountList</name>
        <label>UpdateAccountList</label>
        <locationX>1052</locationX>
        <locationY>1348</locationY>
        <actionName>CreateOpportunityEventHelper</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>GetOpenDealRegistrationOpportunity</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>accList</name>
            <value>
                <elementReference>EndCustomerAccount</elementReference>
            </value>
        </inputParameters>
        <nameSegment>CreateOpportunityEventHelper</nameSegment>
        <offset>0</offset>
    </actionCalls>
    <actionCalls>
        <name>Validate_Assigned_Owner</name>
        <label>Validate Assigned Owner</label>
        <locationX>361</locationX>
        <locationY>2093</locationY>
        <actionName>NewDealRegLeadOwnerHandler</actionName>
        <actionType>apex</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>opportunityId</name>
            <value>
                <elementReference>currentRevenueOpportunity.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>NewDealRegLeadOwnerHandler</nameSegment>
        <offset>0</offset>
    </actionCalls>
    <actionCalls>
        <name>Validate_Assigned_Owner1</name>
        <label>Validate Assigned Owner</label>
        <locationX>1329</locationX>
        <locationY>1398</locationY>
        <actionName>NewDealRegLeadOwnerHandler</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>GetOpenDealRegistrationOpportunity</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>accountId</name>
            <value>
                <elementReference>Get_Partner_Registration_Records.Account__c</elementReference>
            </value>
        </inputParameters>
        <nameSegment>NewDealRegLeadOwnerHandler</nameSegment>
        <offset>0</offset>
    </actionCalls>
    <apiVersion>54.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <name>AccountAssignment</name>
        <label>AccountAssignment</label>
        <locationX>776</locationX>
        <locationY>1022</locationY>
        <assignmentItems>
            <assignToReference>EndCustomerAccount.Initiate_Round_Robin__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>UpdateAssignAccount</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>EndCustomerAccount.Latest_Partner_Account_Interaction__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Partner_Account__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>EndCustomerAccount.Latest_Partner_Program_Interaction__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ProgramType</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>EndCustomerAccount.Number_of_Vehicles__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Number_of_Vehicles__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Check_for_Deal_Reg_Inside_Sales_Enterprise_Assignment</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>GTMS-29648: to Partner Contact values</description>
        <name>Assign_Partner_Contact_Values</name>
        <label>Assign Partner Contact Values</label>
        <locationX>872</locationX>
        <locationY>429</locationY>
        <assignmentItems>
            <assignToReference>PartnerSFContact.Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Partner_Contact__r.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Assign_ProgramType</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_ProgramType</name>
        <label>Assign ProgramType</label>
        <locationX>1080</locationX>
        <locationY>489</locationY>
        <assignmentItems>
            <assignToReference>ProgramType</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Sales_Program_Type__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ProgramType</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ProgramTypeNew</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Is_Partner_Type_Installer</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>GTMS-29648: to map the account values from PR record</description>
        <name>Assigning_Customer_Account_Values</name>
        <label>Assigning Customer Account Values</label>
        <locationX>827</locationX>
        <locationY>216</locationY>
        <assignmentItems>
            <assignToReference>EndCustomerAccount.Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Account__r.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>EndCustomerAccount.Is_Deal_Reg_Account__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Account__r.Is_Deal_Reg_Account__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>EndCustomerAccount.Most_Recent_Source__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Account__r.Most_Recent_Source__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>EndCustomerAccount.Latest_Partner_Account_Interaction__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Account__r.Latest_Partner_Account_Interaction__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>EndCustomerAccount.Latest_Partner_Program_Interaction__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Account__r.Latest_Partner_Program_Interaction__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>EndCustomerAccount.Enterprise_Assignment__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Account__r.Enterprise_Assignment__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>EndCustomerAccount.Initiate_Round_Robin__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Account__r.Initiate_Round_Robin__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>EndCustomerAccount.Inside_Sales_Assignment__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Account__r.Inside_Sales_Assignment__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>EndCustomerAccount.Number_of_Vehicles__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Account__r.Number_of_Vehicles__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>EndCustomerAccount.Owner_Role__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Account__r.Owner_Role__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>EndCustomerAccount.OwnerId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Account__r.OwnerId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>EndCustomerAccount.Name</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Account__r.Name</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>EndCustomerAccount.RecordTypeId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Account__r.RecordTypeId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>EndCustomerAccount.Lane_Four_Segment__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Account__r.Lane_Four_Segment__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Assigning_Customer_Contact_Values</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>GTMS-29648: to map end customer contact values</description>
        <name>Assigning_Customer_Contact_Values</name>
        <label>Assigning Customer Contact Values</label>
        <locationX>660</locationX>
        <locationY>217</locationY>
        <assignmentItems>
            <assignToReference>EndCustomerContact.Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Contact__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>EndCustomerContact.Description</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Contact__r.Description</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Map_Partner_Account_Values</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>GTMS-20575: Created as part of Partner Alignment project</description>
        <name>Map_Existing_Opportunity</name>
        <label>Map Existing Opportunity</label>
        <locationX>1106</locationX>
        <locationY>1646</locationY>
        <assignmentItems>
            <assignToReference>currentRevenueOpportunity</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>GetOpenDealRegistrationOpportunity</elementReference>
            </value>
        </assignmentItems>
    </assignments>
    <assignments>
        <description>GTMS-29648: Created to map the Partner Account field values</description>
        <name>Map_Partner_Account_Values</name>
        <label>Map Partner Account Values</label>
        <locationX>704</locationX>
        <locationY>436</locationY>
        <assignmentItems>
            <assignToReference>PartnerSFAccount.Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Partner_Account__r.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>PartnerSFAccount.Channel_Payout_Type__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Partner_Account__r.Channel_Payout_Type__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>PartnerSFAccount.Referral_Rebate_MSRP__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Partner_Account__r.Referral_Rebate_MSRP__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>PartnerSFAccount.Deal_Registration_Discount__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Partner_Account__r.Deal_Registration_Discount__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>PartnerSFAccount.End_Customer_Discount_CML__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Partner_Account__r.End_Customer_Discount_CML__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>PartnerSFAccount.End_Customer_Discount_MM_ENT__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Partner_Account__r.End_Customer_Discount_MM_ENT__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>PartnerSFAccount.Partner_Program_Tier__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Partner_Account__r.Partner_Program_Tier__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>PartnerSFAccount.Name</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Partner_Account__r.Name</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>PartnerSFAccount.Owner_Role__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Partner_Account__r.Owner_Role__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>PartnerSFAccount.OwnerId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Partner_Account__r.OwnerId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>PartnerSFAccount.Partner_Discount__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Partner_Account__r.Partner_Discount__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>PartnerSFAccount.Partner_Type__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Partner_Account__r.Partner_Type__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>PartnerSFAccount.Program_Type__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Partner_Account__r.Program_Type__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Assign_Partner_Contact_Values</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_Installer_Field_to_True</name>
        <label>Set Installer Field to True</label>
        <locationX>941</locationX>
        <locationY>722</locationY>
        <assignmentItems>
            <assignToReference>InstallerName</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Partner_Account__r.Name</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Customer_Account_and_Contact_found</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Check_for_Deal_Reg_Inside_Sales_Enterprise_Assignment</name>
        <label>Check for Deal Reg/Inside Sales/Enterprise Assignment</label>
        <locationX>690</locationX>
        <locationY>1169</locationY>
        <defaultConnector>
            <targetReference>Check_if_Owner_is_AE</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Deal_Reg_Inside_Sales_Enterprise_Assignment</name>
            <conditionLogic>1 AND (2 OR 3)</conditionLogic>
            <conditions>
                <leftValueReference>Get_Partner_Registration_Records.Account__r.Is_Deal_Reg_Account__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Get_Partner_Registration_Records.Account__r.Enterprise_Assignment__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Get_Partner_Registration_Records.Account__r.Inside_Sales_Assignment__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>GetOpenDealRegistrationOpportunity</targetReference>
            </connector>
            <label>Deal Reg/Inside Sales/Enterprise Assignment</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_if_Owner_Is_ADR</name>
        <label>Check if Owner Is ADR</label>
        <locationX>1237</locationX>
        <locationY>1204</locationY>
        <defaultConnector>
            <targetReference>UpdateAccountList</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Is_Owner_ADR</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Partner_Registration_Records.Account__r.Owner_Role__c</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>ADR</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Validate_Assigned_Owner1</targetReference>
            </connector>
            <label>Is Owner ADR</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_if_Owner_is_AE</name>
        <label>Check if Owner is AE</label>
        <locationX>969</locationX>
        <locationY>1121</locationY>
        <defaultConnector>
            <targetReference>GetOpenDealRegistrationOpportunity</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Owner_Not_AE</name>
            <conditionLogic>NOT(1) AND NOT(2) AND NOT(3)</conditionLogic>
            <conditions>
                <leftValueReference>Get_Partner_Registration_Records.Account__r.Owner_Role__c</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>AE1</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Get_Partner_Registration_Records.Account__r.Owner_Role__c</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>AE2</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Get_Partner_Registration_Records.Account__r.Owner_Role__c</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>AE3</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Check_if_Owner_Is_ADR</targetReference>
            </connector>
            <label>Owner Not AE</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_Revenue_Opportunity</name>
        <label>Check Revenue Opportunity</label>
        <locationX>446</locationX>
        <locationY>1946</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>has_revenue_opportunity</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>currentRevenueOpportunity</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Validate_Assigned_Owner</targetReference>
            </connector>
            <label>has revenue opportunity</label>
        </rules>
    </decisions>
    <decisions>
        <name>Customer_Account_and_Contact_found</name>
        <label>Customer Account and Contact found</label>
        <locationX>1073</locationX>
        <locationY>914</locationY>
        <defaultConnector>
            <targetReference>Send_Email_Alert_on_Failure</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Found</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Partner_Registration_Records.Account__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Get_Partner_Registration_Records.Contact__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>AccountAssignment</targetReference>
            </connector>
            <label>Found</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_Partner_Type_Installer</name>
        <label>Is Partner Type Installer?</label>
        <locationX>1070</locationX>
        <locationY>613</locationY>
        <defaultConnector>
            <targetReference>Customer_Account_and_Contact_found</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Yes_its_Installer</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Partner_Registration_Records.Partner_Team_Alignment__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Installer</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_Installer_Field_to_True</targetReference>
            </connector>
            <label>Yes, its Installer</label>
        </rules>
    </decisions>
    <decisions>
        <description>this node is to check if rvpe__IsDealRegistration__c and Open opportunity exist in system then do not create new opportunity</description>
        <name>IsDealRegistrationOpportunityExist</name>
        <label>IsDealRegistrationOpportunityExist</label>
        <locationX>772</locationX>
        <locationY>1627</locationY>
        <defaultConnector>
            <targetReference>Map_Existing_Opportunity</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>DealRegistrationOpportunityNotExist</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>GetOpenDealRegistrationOpportunity</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Opportunity_Type</targetReference>
            </connector>
            <label>DealRegistrationOpportunityNotExist</label>
        </rules>
    </decisions>
    <decisions>
        <name>Opportunity_Type</name>
        <label>Opportunity Type</label>
        <locationX>446</locationX>
        <locationY>1646</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Rebate</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>ProgramType</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>Paid Referral</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>ProgramType</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>Unpaid Referral</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Create_Partner_Rebate_Opportunity</targetReference>
            </connector>
            <label>Rebate</label>
        </rules>
        <rules>
            <name>Deal_Registration_Margin</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>ProgramType</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>Resale</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Create_Partner_Deal_Reg_Opportunity</targetReference>
            </connector>
            <label>Deal Registration Margin</label>
        </rules>
        <rules>
            <name>End_Customer_Discount</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>ProgramType</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>Teaming</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>ProgramType</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>Premium Discount</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>ProgramType</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>Subsidy</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>ProgramType</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>Safety Program</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Create_Partner_End_Customer_Discount_Opportunity</targetReference>
            </connector>
            <label>End Customer Discount</label>
        </rules>
    </decisions>
    <description>Changes As part of GTMS-10340 add more about opportunity
Opportunity Conversion logic change to Program type
GTMS-16293: Updated flow to map Note__c field on opportunity with Lead field value from Create_Opp_for_Converted_Deal_Reg_Lead flow on 2/1/24
GTMS-20575: Updated flow as part of Partner Alignment project to replace the lead info with Partner Registration record Info
GTMS-26124 &amp; GTMS-26107: Updated as part of Partners H1 project to map Partner Program and Partner Enrollment fields on PR record.
GTMS-29648: Updating flow for better performance and reducing SOQL queries.</description>
    <environments>Default</environments>
    <formulas>
        <name>ProgramTypeNew</name>
        <dataType>String</dataType>
        <expression>TRIM(
SUBSTITUTE(
SUBSTITUTE(
{!ProgramType},
&quot;[&quot;, &quot;&quot;),
&quot;]&quot;, &quot;&quot;))</expression>
    </formulas>
    <formulas>
        <name>UpdateAssignAccount</name>
        <dataType>Boolean</dataType>
        <expression>IF(
AND( {!Get_Partner_Registration_Records.Account__r.Is_Deal_Reg_Account__c} == true, {!Get_Partner_Registration_Records.Account__r.Most_Recent_Source__c} == &apos;Deal Reg Form&apos;), True, False)</expression>
    </formulas>
    <interviewLabel>Create Opp for Converted Deal Reg Lead {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Create Opp for Converted Deal Reg Lead</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <description>GTMS:20575: Created as part of Partner Alignment project to get Partner Registration record details</description>
        <name>Get_Partner_Registration_Records</name>
        <label>Get Partner Registration Records</label>
        <locationX>1073</locationX>
        <locationY>182</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Assigning_Customer_Account_Values</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Partner_Registration_Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Partner_Registration__c</object>
        <queriedFields>Account__c</queriedFields>
        <queriedFields>Contact__c</queriedFields>
        <queriedFields>Description__c</queriedFields>
        <queriedFields>Executive_Introduction__c</queriedFields>
        <queriedFields>Key_Customer_Insight__c</queriedFields>
        <queriedFields>Lead__c</queriedFields>
        <queriedFields>More_About_Opportunity__c</queriedFields>
        <queriedFields>Number_of_Units__c</queriedFields>
        <queriedFields>Number_of_Vehicles__c</queriedFields>
        <queriedFields>Partner_Account__c</queriedFields>
        <queriedFields>Partner_Contact__c</queriedFields>
        <queriedFields>Partner_Program_Enrollment__c</queriedFields>
        <queriedFields>Product_Type__c</queriedFields>
        <queriedFields>Sales_Cycle_Investment__c</queriedFields>
        <queriedFields>Samsara_Recommendation__c</queriedFields>
        <queriedFields>Teaming_Partner__c</queriedFields>
        <queriedFields>Sales_Program_Type__c</queriedFields>
        <queriedFields>Partner_Program__c</queriedFields>
        <queriedFields>Partner_Team_Alignment__c</queriedFields>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>this node is to check if Deal Registration opportunity is present then it will not create another opportunity</description>
        <name>GetOpenDealRegistrationOpportunity</name>
        <label>GetOpenDealRegistrationOpportunity</label>
        <locationX>898</locationX>
        <locationY>1491</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>IsDealRegistrationOpportunityExist</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>AccountId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_Partner_Registration_Records.Account__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>IsClosed</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Is_Deal_Registration__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Opportunity</object>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <runInMode>SystemModeWithoutSharing</runInMode>
    <start>
        <locationX>947</locationX>
        <locationY>48</locationY>
        <connector>
            <targetReference>Get_Partner_Registration_Records</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <subflows>
        <name>Create_Partner_Deal_Reg_Opportunity</name>
        <label>Create Partner Deal Reg Opportunity</label>
        <locationX>428</locationX>
        <locationY>1793</locationY>
        <connector>
            <targetReference>Check_Revenue_Opportunity</targetReference>
        </connector>
        <flowName>New_Create_Partner_Deal_Reg_Opportunity</flowName>
        <inputAssignments>
            <name>ConvertedLeadId</name>
            <value>
                <elementReference>Get_Partner_Registration_Records.Lead__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>EndCustomerAccount</name>
            <value>
                <elementReference>EndCustomerAccount</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>EndCustomerContact</name>
            <value>
                <elementReference>EndCustomerContact</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>MoreAboutOpportunity</name>
            <value>
                <elementReference>Get_Partner_Registration_Records.More_About_Opportunity__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>NumberOfUnits</name>
            <value>
                <elementReference>Get_Partner_Registration_Records.Number_of_Units__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>OpportunityDescription</name>
            <value>
                <elementReference>Get_Partner_Registration_Records.Description__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Partner_Registration</name>
            <value>
                <elementReference>Get_Partner_Registration_Records</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>PartnerSFAccount</name>
            <value>
                <elementReference>PartnerSFAccount</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>PartnerSFContact</name>
            <value>
                <elementReference>PartnerSFContact</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ProductType</name>
            <value>
                <elementReference>Get_Partner_Registration_Records.Product_Type__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ProgramType</name>
            <value>
                <elementReference>ProgramType</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>RetryCounter</name>
            <value>
                <elementReference>RetryCounter</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>TeamingPartner</name>
            <value>
                <elementReference>Get_Partner_Registration_Records.Teaming_Partner__c</elementReference>
            </value>
        </inputAssignments>
        <outputAssignments>
            <assignToReference>Fault_Error_Message</assignToReference>
            <name>Fault_Message</name>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>currentRevenueOpportunity</assignToReference>
            <name>thisRevenueOpportunity</name>
        </outputAssignments>
    </subflows>
    <subflows>
        <name>Create_Partner_End_Customer_Discount_Opportunity</name>
        <label>Create Partner End Customer Discount Opportunity</label>
        <locationX>708</locationX>
        <locationY>1812</locationY>
        <connector>
            <targetReference>Check_Revenue_Opportunity</targetReference>
        </connector>
        <flowName>New_Create_Partner_End_Customer_Discount_Opportunity</flowName>
        <inputAssignments>
            <name>ConvertedLeadId</name>
            <value>
                <elementReference>Get_Partner_Registration_Records.Lead__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>EndCustomerAccount</name>
            <value>
                <elementReference>EndCustomerAccount</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>EndCustomerContact</name>
            <value>
                <elementReference>EndCustomerContact</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Installer</name>
            <value>
                <elementReference>InstallerName</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>MoreAboutOpportunity</name>
            <value>
                <elementReference>Get_Partner_Registration_Records.More_About_Opportunity__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>NumberOfUnits</name>
            <value>
                <elementReference>Get_Partner_Registration_Records.Number_of_Units__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>OpportunityDescription</name>
            <value>
                <elementReference>Get_Partner_Registration_Records.Description__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Partner_Registration</name>
            <value>
                <elementReference>Get_Partner_Registration_Records</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>PartnerSFAccount</name>
            <value>
                <elementReference>PartnerSFAccount</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>PartnerSFContact</name>
            <value>
                <elementReference>PartnerSFContact</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ProductType</name>
            <value>
                <elementReference>Get_Partner_Registration_Records.Product_Type__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>programType</name>
            <value>
                <elementReference>ProgramType</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>RetryCounter</name>
            <value>
                <elementReference>RetryCounter</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>TeamingPartner</name>
            <value>
                <elementReference>Get_Partner_Registration_Records.Teaming_Partner__c</elementReference>
            </value>
        </inputAssignments>
        <outputAssignments>
            <assignToReference>Fault_Error_Message</assignToReference>
            <name>Fault_Message</name>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>currentRevenueOpportunity</assignToReference>
            <name>thisRevenueOpportunity</name>
        </outputAssignments>
    </subflows>
    <subflows>
        <name>Create_Partner_Rebate_Opportunity</name>
        <label>Create Partner Rebate Opportunity</label>
        <locationX>50</locationX>
        <locationY>1754</locationY>
        <connector>
            <targetReference>Check_Revenue_Opportunity</targetReference>
        </connector>
        <flowName>New_Create_Partner_Rebate_Opportunity</flowName>
        <inputAssignments>
            <name>ConvertedLeadId</name>
            <value>
                <elementReference>Get_Partner_Registration_Records.Lead__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>EndCustomerAccount</name>
            <value>
                <elementReference>EndCustomerAccount</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>EndCustomerContact</name>
            <value>
                <elementReference>EndCustomerContact</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Installer</name>
            <value>
                <elementReference>InstallerName</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>MoreAboutOpportunity</name>
            <value>
                <elementReference>Get_Partner_Registration_Records.More_About_Opportunity__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>NumberOfUnits</name>
            <value>
                <elementReference>Get_Partner_Registration_Records.Number_of_Units__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>OpportunityDescription</name>
            <value>
                <elementReference>Get_Partner_Registration_Records.Description__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Partner_Registration</name>
            <value>
                <elementReference>Get_Partner_Registration_Records</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>PartnerSFAccount</name>
            <value>
                <elementReference>PartnerSFAccount</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>PartnerSFContact</name>
            <value>
                <elementReference>PartnerSFContact</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ProductType</name>
            <value>
                <elementReference>Get_Partner_Registration_Records.Product_Type__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ProgramType</name>
            <value>
                <elementReference>ProgramType</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>RetryCounter</name>
            <value>
                <elementReference>RetryCounter</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>TeamingPartner</name>
            <value>
                <elementReference>Get_Partner_Registration_Records.Teaming_Partner__c</elementReference>
            </value>
        </inputAssignments>
        <outputAssignments>
            <assignToReference>Fault_Error_Message</assignToReference>
            <name>FaultMessage</name>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>currentRevenueOpportunity</assignToReference>
            <name>thisRevenueOpportunity</name>
        </outputAssignments>
    </subflows>
    <textTemplates>
        <name>ErrorEmailBodyTemplate</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Unable to find the converted Account or Contact records. Lead Id - {!Get_Partner_Registration_Records.Lead__c}</text>
    </textTemplates>
    <variables>
        <name>AccountToUpdate</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Account</objectType>
    </variables>
    <variables>
        <name>AssignAccount</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>ChannelPaymentMethod</name>
        <dataType>Picklist</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>currentRevenueOpportunity</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <objectType>Opportunity</objectType>
    </variables>
    <variables>
        <name>DealRegistrationOpportunities</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Opportunity</objectType>
    </variables>
    <variables>
        <name>EndCustomerAccount</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>Account</objectType>
    </variables>
    <variables>
        <name>EndCustomerContact</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>Contact</objectType>
    </variables>
    <variables>
        <description>GTMS-20575: Created as part of Partner Alignment project</description>
        <name>Fault_Error_Message</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <description>GTMS-20575: Created as part of Partner Alignment project</description>
        <name>FinalMessage</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>Installer</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>InstallerName</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>leadRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>Lead</objectType>
    </variables>
    <variables>
        <name>leadRecordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>MoreAboutOpportunity</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>NumberOfUnits</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
    </variables>
    <variables>
        <name>NumberOfVehicles</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>OpportunityDescription</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>GTMS-20575: Created as part of Partner Alignment project to map Partner registration record details</description>
        <name>Partner_Registration</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <objectType>Partner_Registration__c</objectType>
    </variables>
    <variables>
        <description>GTMS-20575: Created as part of Partner Alignment project to store the PR Id</description>
        <name>Partner_Registration_Id</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>PartnerId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>PartnerSFAccount</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>Account</objectType>
    </variables>
    <variables>
        <name>PartnerSFContact</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>Contact</objectType>
    </variables>
    <variables>
        <name>PartnerType</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>ProductType</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>ProgramType</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>RetryCounter</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>TeamingPartner</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>UpdateAccount</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Account</objectType>
    </variables>
</Flow>
